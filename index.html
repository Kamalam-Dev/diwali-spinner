<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      background: #1a1a1a;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      text-align: center;
    }

    #wheelContainer {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 40px auto;
    }

    #wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      border: 5px solid #fff;
      transform: rotate(0deg);
      transition: transform 3s cubic-bezier(0.25, 1, 0.5, 1);
      box-shadow: 0 0 20px gold;
    }

    .segment {
      position: absolute;
      width: 50%;
      height: 50%;
      top: 50%;
      left: 50%;
      transform-origin: 0% 0%;
      clip-path: polygon(0 0, 100% 0, 100% 100%);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 10px;
      font-weight: bold;
      color: #fff;
      text-shadow: 2px 2px 5px #000;
    }

    .segment span {
      display: block;
      transform: rotate(0deg);
      transform-origin: center;
    }

    #pointerContainer {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 60px;
      z-index: 20;
      pointer-events: none;
    }

    #pointer {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 30px solid gold;
      filter: drop-shadow(0 0 10px gold);
    }

    #diya {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 40px;
    }

    #name {
      display: block;
      margin: 20px auto 10px auto;
      padding: 5px;
      width: 200px;
      border-radius: 5px;
      border: 2px solid gold;
      text-align: center;
    }

    #spinButton {
      display: block;
      margin: 10px auto 20px auto;
      padding: 10px 20px;
      font-size: 1em;
      background: gold;
      color: #1a1a1a;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 10px gold;
    }

    #spinButton:hover {
      background: orange;
      box-shadow: 0 0 20px orange;
    }

    #result {
      text-align: center;
      font-size: 1.3em;
      margin-top: 20px;
      color: gold;
      text-shadow: 1px 1px 5px red;
    }

    #allResults {
      list-style: none;
      padding: 0;
      margin: 10px auto;
      max-width: 400px;
      text-align: left;
      color: #ffd700;
    }

    canvas {
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <h2>ðŸŽ† Diwali Team Spinner ðŸŽ†</h2>
  <input id="name" placeholder="Enter your name">
  <button id="spinButton">Spin the Diwali Wheel!</button>

  <div id="wheelContainer">
    <div id="pointerContainer">
      <canvas id="diya"></canvas>
      <div id="pointer"></div>
    </div>
    <div id="wheel"></div>
  </div>

  <div id="result"></div>
  <h3>All Spins:</h3>
  <ul id="allResults"></ul>

  <canvas id="confettiCanvas"></canvas>

  <script>
    const wheel = document.getElementById("wheel");
    const spinButton = document.getElementById("spinButton");
    const canvas = document.getElementById("confettiCanvas");
    const ctx = canvas.getContext("2d");

    const diyaCanvas = document.getElementById("diya");
    const dCtx = diyaCanvas.getContext("2d");

    const allResults = document.getElementById("allResults");

    const GOOGLE_SHEET_URL = "https://script.google.com/macros/s/AKfycbxLU4knuUJPB3alfZOZadgMY0pp4_mYVkD0Mtnzgs4VMzrz97Mac5Sv5i0iOaGIKgz5/exec"; // <--- replace this with your Apps Script URL

    const colors = ["#ff4d4d","#ffd11a","#ff9933","#ff66ff","#66ff66","#ff1a1a","#ffcc66","#ff66cc"];
    const teams = ["Team A", "Team B", "Team C", "Team D", "Team E", "Team F", "Team G", "Team H"];
    const numSegments = teams.length;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    diyaCanvas.width = 60;
    diyaCanvas.height = 40;

    // --- Diya animation ---
    function drawDiya() {
      dCtx.clearRect(0, 0, diyaCanvas.width, diyaCanvas.height);
      dCtx.fillStyle = "#ff9900";
      dCtx.beginPath();
      dCtx.moveTo(5,30);
      dCtx.quadraticCurveTo(30,50,55,30);
      dCtx.closePath();
      dCtx.fill();

      const flameHeight = 15 + Math.random()*5;
      const flameWidth = 6;
      const flameX = 30;
      const flameY = 10;
      dCtx.fillStyle = "yellow";
      dCtx.beginPath();
      dCtx.ellipse(flameX, flameY, flameWidth, flameHeight, 0, 0, 2*Math.PI);
      dCtx.fill();
    }
    setInterval(drawDiya, 150);

    // --- Create wheel segments ---
    for (let i = 0; i < numSegments; i++) {
      const seg = document.createElement("div");
      seg.classList.add("segment");
      seg.style.background = colors[i % colors.length];
      const angle = (360 / numSegments) * i;
      seg.style.transform = `rotate(${angle}deg) skewY(${90 - 360 / numSegments}deg)`;

      const label = document.createElement("span");
      label.innerText = teams[i];
      label.style.transform = `rotate(${360 / numSegments / 2 - 90}deg)`; 
      seg.appendChild(label);

      wheel.appendChild(seg);
    }

    let spinning = false;
    let currentRotation = 0;

    function logToGoogleSheet(name, team) {
      fetch(GOOGLE_SHEET_URL, {
        method: "POST",
        body: JSON.stringify({name: name, team: team}),
        headers: {'Content-Type': 'application/json'}
      })
      .then(res => res.json())
      .then(data => {
        if(data.status === "success"){
          console.log(`Logged ${name} â†’ ${team}`);
        } else {
          console.error("Error logging:", data.message);
        }
      })
      .catch(err => console.error("Fetch error:", err));
    }

    spinButton.addEventListener("click", () => {
      const name = document.getElementById("name").value.trim();
      if (!name) { alert("Please enter your name!"); return; }
      if (spinning) return;

      spinning = true;
      document.getElementById("result").innerText = "Spinning... ðŸŽ†";

      const extraRotation = Math.floor(Math.random() * 360);
      currentRotation += 360 * 6 + extraRotation;

      wheel.style.transition = "transform 3s cubic-bezier(0.25, 1, 0.5, 1)";
      wheel.style.transform = `rotate(${currentRotation}deg)`;

      wheel.addEventListener("transitionend", function handler() {
        wheel.style.transition = "none";
        currentRotation = currentRotation % 360;
        wheel.style.transform = `rotate(${currentRotation}deg)`;
        wheel.removeEventListener("transitionend", handler);

        const degreesPerSegment = 360 / numSegments;
        const selectedIndex = Math.floor(((360 - currentRotation + degreesPerSegment/2) % 360) / degreesPerSegment);
        const teamName = teams[selectedIndex];

        // Display result for this participant
        document.getElementById("result").innerHTML = `ðŸŽ‰ ${name}, youâ€™ve been assigned to <b>${teamName}</b>!`;

        // Add to live board
        const li = document.createElement("li");
        li.innerHTML = `${name} â†’ <b>${teamName}</b>`;
        allResults.appendChild(li);

        // Log to Google Sheet
        logToGoogleSheet(name, teamName);

        // Reset input for next participant
        document.getElementById("name").value = "";
        document.getElementById("name").focus();

        spinning = false;
        launchDiwaliConfetti();
      });
    });

    // --- Diwali Confetti ---
    const confettiParticles = [];
    function launchDiwaliConfetti() {
      const colors = ["#ffcc33","#ff3300","#ff66ff","#ff9900","#ffcc66"];
      const numParticles = 120;
      for (let i = 0; i < numParticles; i++) {
        confettiParticles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height - canvas.height,
          r: Math.random() * 5 + 2,
          d: Math.random() * 10 + 5,
          color: colors[Math.floor(Math.random() * colors.length)],
          tilt: Math.random() * 10 - 10,
          tiltAngleIncrement: Math.random() * 0.05 + 0.02,
          type: Math.random() < 0.3 ? 'spark' : 'circle'
        });
      }
      requestAnimationFrame(drawConfetti);
    }

    function drawConfetti() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < confettiParticles.length; i++) {
        const p = confettiParticles[i];
        ctx.beginPath();
        ctx.strokeStyle = p.color;
        ctx.fillStyle = p.color;
        if (p.type === 'circle') {
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fill();
        } else {
          ctx.lineWidth = p.r / 2;
          ctx.moveTo(p.x + p.tilt, p.y);
          ctx.lineTo(p.x + p.tilt + p.r * 2, p.y + p.r * 2);
          ctx.stroke();
        }

        p.y += (Math.cos(p.d) + 2 + p.r / 2) / 2;
        p.tilt += p.tiltAngleIncrement;

        if (p.y > canvas.height) {
          confettiParticles.splice(i, 1);
          i--;
        }
      }
      if (confettiParticles.length > 0) {
        requestAnimationFrame(drawConfetti);
      }
    }

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });
  </script>
</body>
</html>
